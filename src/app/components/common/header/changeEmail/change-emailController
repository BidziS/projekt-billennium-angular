import apiService from '../../../../api/apiService';

export default class ChangeEmailController {
    constructor(apiService, $mdToast, $state, $mdDialog) {
        this.apiService = apiService;
        this.$mdToast = $mdToast;
        this.$state = $state;
        this.$mdDialog = $mdDialog;
        this.email = {
            OldEmailAddress: '',
            EmailAddress: '',
            NewEmailAddress: ''
        };

    }

    changeEmail() {
        if (this.email.EmailAddress !== this.email.NewEmailAddress) {
            this.badEmails();
        } else {
            console.log(this.email);
            this.apiService.postRequest('/api/Account/ChangeEmailAddress', this.email)
                .then(response => {
                    console.log(response);
                    this.changedEmail();
                    this.$state.go('home.statistic');
                })
                .catch(error => {
                    this.badApi();
                })
        }
    }

    badEmails() {
        this.$mdToast.show(
            this.$mdToast.simple()
                .content("Passwords are different")
                .position('top center')
                .hideDelay(4000)
        );
    }

    changedEmail() {
        this.$mdToast.show(
            this.$mdToast.simple()
                .content("Email is changed")
                .position('top center')
                .hideDelay(4000)
        );
    }

    badApi() {
        this.$mdToast.show(
            this.$mdToast.simple()
                .textContent("   Oops... server don't answer")
                .position('top center')
                .hideDelay(4000)
        );
    }

    showConfirm() {
        let confirm = this;
        let conf = confirm.$mdDialog.confirm()
            .title(`Do you want to change your email?`)
            .textContent('')
            .ariaLabel('')
            // .targetEvent(ev)
            .ok('Confirm')
            .cancel('Abort');

        let hideDialog = function () {
            this.changeEmail();
        };
        confirm.$mdDialog.show(conf)
            .then(hideDialog => {
                confirm.changeEmail();
            })
            .catch(() => {
                confirm.$mdDialog.cancel(conf);
            });
    };
}